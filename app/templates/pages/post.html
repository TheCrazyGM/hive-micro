{% extends "layout/base.html" %}
{% import "partials/posts.html" as posts %}
{% block title %}Post{% endblock %}
{% block extra_head %}
  {% if item %}
    <meta property="og:title" content="@{{ item.author }} on {{ config['APP_ID'] }}" />
    <meta property="og:description" content="{{ item.html|striptags|truncate(200) }}" />
    <meta property="og:image" content="https://images.hive.blog/u/{{ item.author|lower|urlencode }}/avatar" />
    <meta property="og:url" content="{{ url_for('ui.post_page', trx_id=trx_id, _external=True) }}" />
    <meta property="og:type" content="article" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="@{{ item.author }} on {{ config['APP_ID'] }}" />
    <meta name="twitter:description" content="{{ item.html|striptags|truncate(200) }}" />
    <meta name="twitter:image" content="https://images.hive.blog/u/{{ item.author|lower|urlencode }}/avatar" />
  {% else %}
    <meta property="og:title" content="{{ config['APP_ID'] }} - Post" />
    <meta property="og:description" content="A post on {{ config['APP_ID'] }}" />
    <meta property="og:url" content="{{ url_for('ui.post_page', trx_id=trx_id, _external=True) }}" />
    <meta property="og:type" content="article" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="{{ config['APP_ID'] }} - Post" />
    <meta name="twitter:description" content="A post on {{ config['APP_ID'] }}" />
  {% endif %}
{% endblock %}
{% block content %}
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-9 col-xl-8" style="max-width: 960px;">
      {{ posts.post_card(item, True) }}
      {% if session.username and (session.username|lower) in (config['MODERATORS'] or []) %}
        <div class="card mb-3">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <strong>Moderation</strong>
              <small class="text-muted">Signed: {{ 'required' if config['MOD_REQUIRE_SIGNATURE'] else 'optional' }}</small>
            </div>
            <div class="mt-2 d-flex gap-2 align-items-center">
              <input type="text" id="modReason" class="form-control" placeholder="Reason (optional)" />
              {% if is_hidden %}
                <button id="modUnhideBtn" class="btn btn-sm btn-success">Unhide</button>
              {% else %}
                <button id="modHideBtn" class="btn btn-sm btn-danger">Hide</button>
              {% endif %}
            </div>
            <div id="modStatus" class="small text-muted mt-2"></div>
            <div class="mt-3" id="modLog"></div>
          </div>
        </div>
        <script>
          window.__POST_TRX_ID__ = {{ trx_id | tojson }};
          window.__MOD_QUORUM__ = {{ config['MOD_QUORUM'] | tojson }};
          window.__POST_HIDDEN__ = {{ (is_hidden or false) | tojson }};
        </script>
        <script src="{{ url_for('static', filename='js/moderation.js') }}"></script>
      {% endif %}
      {{ posts.replies_list(replies) }}
      <script src="{{ url_for('static', filename='js/post_view.js') }}"></script>
    </div>
  </div>

{% endblock %}
